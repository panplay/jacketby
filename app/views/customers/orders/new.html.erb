<section class="container">
  <h2>購入確認</h2>
    <%= form_for(@order,url: customers_orders_path , method: :post) do |f| %>
        <h4>お届け先</h4>
        <%= f.label :宛名 %>
          <%= f.text_field :delivery_name, class:"form-control" %>
        <%= f.label :メイン住所 %>
        <div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; width: 60%;">
            <%= f.radio_button :destination, @customer.address, checked:"checked" %>
             <p>〒<%= @customer.postal_code %></p>
             <p><%= @customer.address %></p>
            <%= f.hidden_field :postal_code, :value => @customer.postal_code, class:"form-control" %>
            <%= f.hidden_field :status, :value => :受付, class:"form-control" %>
            <%= f.hidden_field :order_time, :value => Time.now, class:"form-control" %>
            <%= f.hidden_field :delivery_charge, :value => 500, class:"form-control" %>
            <%= f.hidden_field :customer_id, :value => current_customer.id, class:"form-control" %>
        </div>
        <%= f.label :その他登録住所 %>
        <div style= "padding: 10px; margin-bottom: 10px; border: 1px solid #333333; width: 60%;">
          <% @addresses.each.with_index(1) do |address,i| %>
            <p>住所<%= i %></p>
            <div style= "padding: 10px; margin-bottom: 10px; border: 1px solid #333333; width: 100%;">
                <%= f.radio_button :destination, address.address %>
                <p>〒<%= address.postal_code %></p>
                <p><%= address.address %></p>
                <%= f.hidden_field :postal_code, :value => address.postal_code, class:"form-control" %>
                <% binding.pry %>
                <%= f.hidden_field :status, :value => :受付, class:"form-control" %>
                <%= f.hidden_field :order_time, :value => Time.now, class:"form-control" %>
                <%= f.hidden_field :delivery_charge, :value => 500, class:"form-control" %>
                <%= f.hidden_field :customer_id, :value => current_customer.id, class:"form-control" %>
            </div>
          <% end %>
        </div>
  <%= link_to "新しい送り先に送る場合は、こちら",customers_orders_new2_path %>
        <h4>支払い方法</h4>
        <div class="field">
            <%= f.radio_button :payment, :クレジットカード %>
            <%= f.label :クレジットカード %>
            <%= f.radio_button :payment, :銀行振込 %>
            <%= f.label :銀行振込 %>
            <%= f.radio_button :payment, :代引き %>
            <%= f.label :代引き %>
        </div>
        <h4>注文内容</h4>
        <% sum = 0 %>
        <% quantity_sum = 0 %>
          <% @carts.each do |cart| %>
            <%= attachment_image_tag cart.item, :image, class: "book-img float-left", size: "150x150" %>
            <%= cart.item.name %>
            <p>数量：<%= cart.quantity %></p>
            <p>¥<%= (cart.item.price * 1.1).to_i %>  (税込)</p>
            <% sum += ((cart.item.price * 1.1).to_i * cart.quantity) %>
            <% quantity_sum += cart.quantity %>
            <%= link_to "削除", customers_customer_cart_path(current_customer.id,cart.id), method: :delete,class: "btn btn-sm btn-link" %>
             <%= f.hidden_field :total_price, :value => cart.quantity * (cart.item.price * 1.1).to_i, class:"form-control" %>
           <% end %>
          商品の小計（<%= quantity_sum %>点）： ¥ <%= sum %> (税込)
          <br>送料（全国一律）： ¥ 500</br>
          ご請求額：¥ <%= sum + 500 %> (税込)
        <%= f.submit '注文を確定する' , class:"btn btn-warning btn-block" %>
    <% end %>
</section>
